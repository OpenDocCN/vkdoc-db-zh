# 九、执行表和数据库操作

在前面的章节中，我们主要讨论表列。在本章中，我们将学习如何执行一些影响整个表或数据库的操作。我们将介绍表属性以及如何修改它们，还将讨论多表操作。

在 `Table`视图的**操作**页面上，已将启用表操作的各种链接放在一起。以下是本页面的概述：

![Performing Table and Database Operations](img/7782_09_01.jpg)

# 维持一张桌子

在表的生命周期中，表会反复修改，因此会不断增长和收缩。服务器上可能会发生中断，导致某些表处于损坏状态。

使用**操作**页面，我们可以执行各种操作，下面列出。但是，并非每个存储引擎都可以执行所有操作。

*   **检查表：**扫描所有行，验证删除的链接是否正确。还计算校验和以验证密钥的完整性。如果一切正常，我们将获得一条消息，说明**OK**或**表已经是最新的**；如果显示任何其他消息，则是时候修复此表（请参阅**修复表**要点）。
*   **分析表：**分析存储密钥分布；这将用于后续的 `JOIN`操作，以确定表的联接顺序。应定期执行此操作（以防表中的数据发生变化），以提高 `JOIN`效率。
*   **修复表：**修复 `MyISAM`和 `ARCHIVE`引擎中表的任何损坏数据。请注意，表可能已损坏，我们甚至无法进入 `Table`视图查看它！在这种情况下，请参阅*多表操作*章节了解维修程序。
*   **碎片整理表：**随机插入或删除 `InnoDB`表碎片及其索引。应定期对表进行碎片整理，以便更快地检索数据。此操作导致 MySQL 重建表，仅适用于 `InnoDB`。
*   **优化表：**当表包含管理费用时，此选项非常有用。大量删除行或更改 `VARCHAR`列的长度后，丢失的字节仍保留在表中。phpMyAdmin 会在不同的地方（例如， `Structure`视图）警告我们，如果它认为表应该优化。此操作回收表中未使用的空间。在 MySQL 5.x 中，可以优化的相关表使用 `MyISAM, InnoDB`和 `ARCHIVE`引擎。
*   **Flush table:**这必须在出现很多连接错误并且 MySQL 服务器阻止进一步连接时进行。刷新将清除一些内部缓存，并允许恢复正常操作。

### 注

这些操作基于可用的底层 MySQL 查询，phpMyAdmin 仅调用这些查询。更多详情请访问[http://dev.mysql.com/doc/refman/5.5/en/table-maintenance-sql.html](http://dev.mysql.com/doc/refman/5.5/en/table-maintenance-sql.html) 。

# 更改表属性

表属性是表的各种属性。本节讨论其中一些的设置。

## 表存储引擎

我们可以更改的第一个属性称为**存储引擎**。

![Table storage engine](img/7782_09_02.jpg)

这将控制表的整个行为—它的位置（在磁盘或内存中）、索引结构，以及它是否支持事务和外键。下拉列表因 MySQL 服务器支持的存储引擎而异。

### 注

如果行数很大，更改表的存储引擎可能需要很长时间。

## 表备注

**表注释**选项允许我们为表输入注释。

![Table comments](img/7782_09_03.jpg)

这些注释将显示在适当的位置，例如，在导航面板中， `Table`视图中的表名旁边，以及在导出文件中。以下屏幕截图显示了当 `$cfg['ShowTooltip']`参数设置为其默认值 `TRUE:`时导航面板的外观

![Table comments](img/7782_09_04.jpg)

`$cfg['ShowTooltipAliasDB']`和 `$cfg['ShowTooltipAliasTB']`的默认值 `(FALSE)` 产生了我们之前看到的行为**结构**页面的导航面板和 `Database`视图中显示了真实的数据库和表名。注释显示为工具提示（当光标悬停在数据库或表名上时）。如果其中一个参数设置为 `TRUE`，则默认情况下，该行为会反转，并将注释和真实名称显示为工具提示。当实际表名没有意义时，这很方便。

`$cfg['ShowTooltipAliasTB']—` 的 `'nested'`值还有另一种可能性。下面是使用此功能时发生的情况：

*   真正的表名显示在导航面板中
*   表注释（例如， `project__)`被解释为项目名称并按原样显示（参见[第三章](03.html "Chapter 3. Over Viewing the Interface")中数据库部分中的*嵌套表显示）*

## 表顺序

当我们浏览一个表，或者在没有指定排序顺序的情况下执行一个语句，比如 `SELECT * from book`，MySQL 使用物理存储行的顺序。可通过对话框**更改表顺序来更改此表顺序。我们可以选择任何列，表将在此列上重新排序一次。我们在示例中选择**author_id**，点击**Go**后，表将按此列排序。**

如果我们知道大部分时间都是按这种顺序检索行，那么重新排序是很方便的。此外，如果我们稍后使用一个 `ORDER BY`子句，并且表已经在此列上进行了物理排序，那么我们可能会获得更好的性能。

只要表中没有更改（没有插入、删除或更新），此默认顺序就会持续。这就是 phpMyAdmin 显示**（单个）**警告的原因。

![Table order](img/7782_09_05.jpg)

在**作者 id**上完成排序后，将首先显示作者**1**的书籍，然后显示作者**2**的书籍，依此类推（我们讨论的是默认浏览表而不显式排序）。我们也可以将排序顺序指定为**升序**或**降序**。

如果我们插入另一行，描述作者**1**的新书，然后单击**浏览**，该书将不会与该作者的其他书一起显示，因为排序是在插入之前完成的。

## 表整理

基于字符的列具有排序规则属性，该属性描述用于解释内容的字符集以及排序规则。**名称**栏目前有一个**拉丁文 1_ 瑞典语 ci**排序规则，从**结构**页面可以看出。在**操作**页面上，如果我们将表 `author`的排序规则从**拉丁 1_ 瑞典 _ci**更改为**utf8_general_ci**，则会生成以下语句：

```php
ALTER TABLE `author` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci

```

因此，我们只更改了将添加到此表中的未来列的默认排序规则；未更改现有列的排序规则。

## 表选项

可以使用**表选项**对话框指定影响表行为的其他属性

![Table options](img/7782_09_06.jpg)

这些选择包括：

*   **PACK_KEYS:**设置此属性会导致索引变小。这可以更快地读取，但需要更多的时间来更新。可用于 `MyISAM`存储引擎。
*   **校验和：**这使得 MySQL 为每一行计算一个校验和。这会导致更新速度变慢，但查找损坏的表变得更容易。仅适用于 `MyISAM`。
*   **DELAY_KEY_WRITE:**这指示 MySQL 不要立即写入索引更新，而是将它们排队等待稍后写入。这提高了性能，但有一个负面的权衡，即如果服务器出现故障，可能需要重建索引（请参阅[http://dev.mysql.com/doc/refman/5.1/en/miscellaneous-optimization-tips.html)](http://dev.mysql.com/doc/refman/5.1/en/miscellaneous-optimization-tips.html))。仅适用于 `MyISAM`。
*   **事务性，PAGE_ 校验和：**适用于 `Aria`存储引擎，以前称为 `Maria`。**事务性**选项将此表标记为事务性；但是，此选项的确切含义有所不同，因为此存储引擎的未来版本将获得更多事务性功能。**页面校验和**计算所有索引页面上的校验和。目前记录在[http://kb.askmonty.org/en/aria-storage-engine](http://kb.askmonty.org/en/aria-storage-engine) 。
*   **行格式：**对于支持此功能的存储引擎 `(MyISAM, InnoDB, PBXT`和 `Aria)`，提供了行格式的选择。默认值是此表行格式的当前状态。
*   **自动增量：**改变自动增量值。仅当表的主键具有自动递增属性时，才会显示该属性。

# 清空或删除表

清空表（擦除其数据）和删除表（擦除其数据和表的结构）可以通过位于**删除数据或表**部分的**清空表（截断）**和**删除表（删除）**链接来完成。

# 重命名、移动和复制表

**重命名**操作是最容易理解的操作，该表只需更改其名称并保留在同一数据库中。

**移动**操作（如下屏幕截图所示）以两种方式操作一个表，更改其名称以及存储该表的数据库。

![Renaming, moving, and copying tables](img/7782_09_07.jpg)

MySQL 不直接支持移动表。因此，phpMyAdmin 必须在目标数据库中创建表，复制数据，然后最后删除源表。根据桌子的大小，这可能需要很长时间。

**复制**操作使原始表保持不变，并将其结构或数据（或两者）复制到另一个表，可能在另一个数据库中。在这里，**图书副本**表将是 `book`源表的精确副本。复制后， `book`表仍在 `Table`视图中，除非我们选择了**切换到复制表**选项，在这种情况下，我们将移动到新创建表的 `Table`视图中。

![Renaming, moving, and copying tables](img/7782_09_08.jpg)

只复制**结构**以创建具有相同结构但没有数据的测试表。

## 将数据追加到表中

**复制**对话框也可用于从一个表向另一个表追加（添加）数据。两个表必须具有相同的结构。此操作通过输入要复制数据的表并选择**仅数据**来实现。

例如，图书数据来自不同的来源（不同的出版商），每个出版商有一个表，我们希望将所有数据聚合到一个地方。对于 `MyISAM`，可以通过使用 `Merge`存储引擎（它是相同的 `MyISAM`表的集合）获得类似的结果。但是，如果表是 `InnoDB`，我们需要依赖 phpMyAdmin 的**复制**功能。

# 执行其他表操作

在表**操作**界面上，可能会出现其他对话框。参考完整性验证对话框将在[第 10 章](10.html "Chapter 10. Benefiting from the Relational System")中介绍。分区维护将在[第 17 章](17.html "Chapter 17. Supporting Features Added in MySQL 5")中进行检查。

# 多表操作

在 `Database`视图中，每个表名旁边都有一个复选框，表列表下有一个下拉菜单。这使我们能够快速选择一些表，并同时对所有这些表执行操作。在这里，我们选择**图书复制**和**图书**表，并为所选表选择**检查表**操作，如下图截图所示：

![Multi-table operations](img/7782_09_09.jpg)

我们还可以使用**全选/全选**选项快速选择或取消选择所有复选框。

## 维修“在用”表

多表模式是修复损坏表的唯一方法（除非我们知道要键入的确切 SQL 查询）。这些表可以在数据库列表中用**正在使用**标志来显示。在 phpMyAdmin 支持论坛中寻求帮助的用户通常会收到来自经验丰富的 phpMyAdmin 用户的此提示。

# 数据库操作

`Database`视图中的**操作**选项卡提供对面板的访问，该面板使我们能够对作为一个整体的数据库执行操作，如以下屏幕截图所示：

![Database operations](img/7782_09_10.jpg)

## 重命名数据库

一个**将数据库重命名为**对话框可用。虽然 MySQL 不直接支持此操作，但 phpMyAdmin 通过创建一个新数据库、重命名每个表（从而将其发送到新数据库）并删除原始数据库来间接支持此操作。

## 复制数据库

即使 MySQL 本身不支持本机操作，也可以对数据库进行完整复制。这些选项与已经为表副本解释的选项类似。

![Copying a database](img/7782_09_11.jpg)

# 总结

本章介绍了我们可以对整个表或数据库执行的操作。它还研究了用于表修复和优化、更改各种表属性、表移动（包括重命名和移动到另一个数据库）以及多表操作的表维护操作。

在下一章中，我们将开始研究依赖于 phpMyAdmin 配置存储的高级功能，例如关系系统。