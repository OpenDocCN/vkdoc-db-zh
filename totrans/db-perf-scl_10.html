<html><head></head><body><div epub:type="chapter" role="doc-chapter"><div class="ChapterContextInformation"><div class="ContextInformation" id="b978-1-4842-9711-7_11"><div class="ChapterCopyright">© The Author(s) 2023</div><span class="ContextInformationAuthorEditorNames">F. C. Mendes et al.</span><span class="ContextInformationBookTitles"><span class="BookTitle">Database Performance at Scale</span></span><span class="ChapterDOI"><a href="https://doi.org/10.1007/978-1-4842-9711-7_11">https://doi.org/10.1007/978-1-4842-9711-7_11</a></span></div></div><!--Begin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">11. Administration</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Felipe Cardeneti Mendes</span><sup><a href="#Aff5">1</a> <span class="ContactIcon"> </span></sup>, </span><span class="Author"><span class="AuthorName">Piotr Sarna</span><sup><a href="#Aff6">2</a></sup>, </span><span class="Author"><span class="AuthorName">Pavel Emelyanov</span><sup><a href="#Aff7">3</a></sup> and </span><span class="Author"><span class="AuthorName">Cynthia Dunlop</span><sup><a href="#Aff8">4</a></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff5"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">São Paulo, São Paulo, Brazil</div></div><div class="Affiliation" id="Aff6"><span class="AffiliationNumber">(2)</span><div class="AffiliationText">Pruszków, Poland</div></div><div class="Affiliation" id="Aff7"><span class="AffiliationNumber">(3)</span><div class="AffiliationText">Moscow, Russia</div></div><div class="Affiliation" id="Aff8"><span class="AffiliationNumber">(4)</span><div class="AffiliationText">Carpinteria, CA, USA</div></div><div class="ClearBoth"> </div></div></div><div class="ArticleOrChapterToc"><div class="TocLine"><a href="#Sec1">Admin Operations and Performance</a></div><div class="TocLine"><a href="#Sec2">Looking at Admin Operations Through the Lens of Performance</a></div><div class="TocLine"><a href="#Sec3">Backups</a></div><div class="TocLine"><a href="#Sec6">Compaction</a></div><div class="TocLine"><a href="#Sec9">Summary</a></div></div><!--End Abstract--><div class="Fulltext">
        <p class="Para" id="Par2">A database’s automated admin operations work to keep things tight and tidy behind the scenes, but a level of supervision is required. Databases don’t know your business and could very naively decide to execute resource-intensive admin operations at what’s actually a performance-critical time. This final chapter details how common admin operations tend to impact performance. It covers the nature and severity of representative impacts and offers some tips on how you might mitigate them.</p>
        <section class="Section1 RenderAsSection1" id="Sec1">
          <h2 class="Heading">Admin Operations and Performance</h2>
          <p class="Para" id="Par3">You might see promises of “zero impact” admin <span id="ITerm1">operations</span><span id="ITerm2"/>, but remember that the laws of physics mean that’s not possible. Performing any operation consumes resources. And when you’re operating at extreme speed and scale, these operations may introduce exacerbated impacts. Given use cases that need to operate at sub-millisecond or single-digit millisecond P99 latency, it doesn’t take much for background tasks to have a noticeable impact. With a latency-sensitive use case, there can be absolutely no system contention during its execution. Even admin operations that will ultimately improve your database performance could inevitably hurt performance to some extent as they are executing. The better you understand the extent of their impact on your specific workload, the more effectively you can strategize to minimize disruption.</p>
          <p class="Para" id="Par4">Low-level details about what admin operations are required will vary from database to database and also change over time; that’s well beyond the scope of this book. This chapter focuses on how admin operations could end up <span id="ITerm3">undermining</span> the other work you’ve done to optimize database performance—and how to avoid that scenario. It starts by presenting a quick rule of thumb to prioritize your focus. Then, examples of backups and compaction will showcase the potentially significant—and also highly variable—impact of admin operations on performance.</p>
        </section>

        <section class="Section1 RenderAsSection1" id="Sec2">
          <h2 class="Heading">Looking at Admin Operations Through the Lens of Performance</h2>
          <p class="Para" id="Par5">Every admin operation, from backups to data migrations to adding and reducing capacity, consumes resources that <em class="EmphasisTypeItalic ">might</em> otherwise be spent on your workload. The impact of an admin operation will vary across databases and workloads. What’s more, an impact that results in lost revenue for one company might be completely acceptable for another.</p>
          <div class="Para" id="Par6">What admin operations should you focus on from the <span id="ITerm4">performance</span> perspective? As shown in Figure <span class="InternalRef"><a href="#Fig1">11-1</a></span>, work through three key considerations for every admin operation that’s being performed.<div class="OrderedList"><ol><li class="ListItem"><div class="ItemNumber">1.</div><div class="ItemContent">
                <p class="Para" id="Par7">What’s the impact on your specific workload at your current or projected scale?</p>
              </div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">2.</div><div class="ItemContent">
                <p class="Para" id="Par8">How much does that impact matter to your business?</p>
              </div><div class="ClearBoth"> </div></li><li class="ListItem"><div class="ItemNumber">3.</div><div class="ItemContent">
                <p class="Para" id="Par9">To what extent can you control it?</p>
              </div><div class="ClearBoth"> </div></li></ol></div><figure class="Figure" id="Fig1"><div class="MediaObject" id="MO1">
              <img alt="" aria-describedby="d65e497" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Fig1_HTML.jpg" style="width:22.05em"/><div class="TextObject" id="d65e497">
                <p class="Para" id="Par64">A Venn diagram of performance optimization focus. It has three circles that denote performance impact, business impact, and controllable. Focus is present at the intersection of the three circles.</p>
              </div>
              
            </div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 11-1</span>
                <p class="SimplePara">A quick rule of thumb for where to focus your admin-related performance <span id="ITerm5">optimizations</span></p>
              </div></figcaption></figure></div>
          <p class="Para" id="Par10">If there is no discernible performance impact for your scenario, then the second and third questions don’t really matter. If there’s a significant and business-critical impact but you can’t control it, you’re in the tough position of deciding whether to accept it or consider moving to an alternative database. If the stars align and you <em class="EmphasisTypeItalic ">can</em> control something that’s both impactful and business-critical, that’s a great place to focus.</p>
          <p class="Para" id="Par11">For example, consider PostgreSQL’s autovacuum function. As of this writing, autovacuum is triggered when a specified scale factor/threshold is exceeded. This is likely to coincide with heavy activity on the table—which is probably <em class="EmphasisTypeItalic ">not</em> when you want background admin tasks to kick in. Starving some tables while repeatedly vacuuming others is common, and users trying to compel autovacuum to hit starved tables can easily end up pushing the system beyond its limit. What’s the likely impact on the business? Probably fairly high for any performance-sensitive use case. And to what extent can you control it? Quite well. For example, you can tune autovacuum settings at both the global and table level, as well as apply strategies like supplementing autovacuum with additional scheduled vacuum jobs. The bottom line here is that this is a great performance optimization opportunity.</p>
          <p class="Para" id="Par12">On the other hand, if you are using a managed DBaaS such as <span id="ITerm6">DynamoDB</span>, admin operations such as data cleanup might be largely beyond your scope of visibility and control. It certainly doesn’t hurt to ask your vendor what they’re willing to divulge about what, when, and how admin operations are performed. Even if you discover that an admin operation undermines performance in a way that matters for you, you might not be able to control it—but at least you can better prepare for it and diagnose the performance hit when it occurs.</p>
          <div class="Para" id="Par13">Among admin operations that could negatively impact <span id="ITerm7">performance</span>, some of the most common suspects are:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li>
              <p class="Para" id="Par14"><strong class="EmphasisTypeBold ">Node recovery</strong>: This involves existing replicas streaming data in order to recover the missing replica. Existing replicas need to read through all the data required by the recovered replica and transfer its results via the network.</p>
            </li><li>
              <p class="Para" id="Par15"><strong class="EmphasisTypeBold ">Ramping up/down capacity</strong>: This often requires an entire cluster or region to rebalance data. Ramping up capacity means that data will be streamed from other replicas to the new one, while ramping down means that the node being removed will stream data out to existing replicas.</p>
            </li><li>
              <p class="Para" id="Par16"><strong class="EmphasisTypeBold ">Data migration</strong>: Migration often affects latency on the source cluster. Since a data migration typically involves no downtime, a balance between speed and service stability is needed in order to avoid impacting existing production workloads.</p>
            </li><li>
              <p class="Para" id="Par17"><strong class="EmphasisTypeBold ">Database upgrades</strong>: Although the outcome of an upgrade is likely to improve performance, remember that restarting a database instance results in a cold cache. This may affect read latencies if the use case in question is cache heavy.</p>
            </li><li>
              <p class="Para" id="Par18"><strong class="EmphasisTypeBold ">Logging and tracing</strong>: When you’re trying to understand a specific pattern or impact, logging and tracing will be important. Databases provide several verbosity levels for many logging components, as well as the ability to enable tracepoints toward your query plans. However, enabling both logging and tracing should be done with caution because they can potentially be resource-intensive operations.</p>
            </li><li>
              <p class="Para" id="Par19"><strong class="EmphasisTypeBold ">Data synchronization</strong>: Eventually consistent databases don’t guarantee that all the data you’re looking for will be immediately available <span id="ITerm8">across</span> all natural replicas. As a result, a background process is often needed to get data in sync. This typically involves each replica reading through its existing data, comparing it with its peers, and applying any relevant changes.</p>
            </li></ul></div></div>
          <p class="Para" id="Par20">Two of the most common operations that impact performance across a variety of databases are backups and compaction. Let’s take a deeper look at both.</p>
        </section>

        <section class="Section1 RenderAsSection1" id="Sec3">
          <h2 class="Heading">Backups</h2>
          <p class="Para" id="Par21"><span id="ITerm9">Backups</span>—a common maintenance procedure for any database—can be surprisingly resource intensive. For example, consider a backup strategy where data deduplication is required. As data in the database frequently gets written or overwritten, backups may consume several CPU cycles and disk I/O on reads in order to compare whether the data to be backed up has already been saved. Then, as it finds newer data that must be retained, it eventually uploads the data (which also involves issuing underlying I/O reads) to a safe location. As the process is repeated across multiple nodes, its parallelism often ends up hurting latencies, especially for use cases that heavily rely on disk I/O to fetch information.</p>
          <section class="Section2 RenderAsSection2" id="Sec4">
            <h3 class="Heading">Impacts</h3>
            <div class="Para" id="Par22">Factors that influence a backup’s performance <span id="ITerm10">impact</span> include:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li>
                <p class="Para" id="Par23"><strong class="EmphasisTypeBold ">Dataset size and replication factor</strong>: The more data you’re backing up, the more time it takes to run a backup. Depending on the number of files stored on disk, backing up may use a lot of read I/O to scan through all the required database blobs.</p>
              </li><li>
                <p class="Para" id="Par24"><strong class="EmphasisTypeBold ">Scope</strong>: Are you backing up all on-disk data files all the time (full backup)? A specific cluster? A system-wide snapshot? An incremental backup? A properly defined backup strategy and scope will help you mitigate the impact.</p>
              </li><li>
                <p class="Para" id="Par25"><strong class="EmphasisTypeBold ">Frequency</strong>: Frequent small backups will result in a more constant low-level pain; less frequent, but larger backups will cause a sharper pain, but that pain will be inflicted less frequently.</p>
              </li><li>
                <p class="Para" id="Par26"><strong class="EmphasisTypeBold ">Bandwidth throttling</strong>: The option to compress or spread out the backup pain helps teams who want to get backups completed as fast as possible during low peak periods (if any exist) or to run them as unobtrusively as possible during steady workloads.</p>
              </li><li>
                <p class="Para" id="Par27"><strong class="EmphasisTypeBold ">Scheduling options</strong>: The ability to control precisely when backups occur allows teams with spiky workloads to avoid backups during likely peak periods.</p>
              </li><li>
                <p class="Para" id="Par28"><strong class="EmphasisTypeBold ">Data compression</strong>: Greater compression will save on storage, but it comes at the cost of increased CPU usage as the backup runs.</p>
              </li><li>
                <p class="Para" id="Par29"><strong class="EmphasisTypeBold ">Parallelism</strong>: The more nodes you back up in parallel, the faster it completes—but at the risk of starving disk I/O capacity along with your ongoing workload.</p>
              </li><li>
                <p class="Para" id="Par30"><strong class="EmphasisTypeBold ">Storage medium</strong>: Reads from local SSDs are noticeably faster than regular disks. As a result, if your database relies on slow-access storage <span id="ITerm11">devices</span>, it is much easier for backups to deplete your available read capacity.</p>
              </li></ul></div></div>
          </section>

          <section class="Section2 RenderAsSection2" id="Sec5">
            <h3 class="Heading">Optimization</h3>
            <div class="Para" id="Par31">Before you start adjusting any options, consider these two critical questions:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li>
                <p class="Para" id="Par32">What’s your business’ tolerance for data loss?</p>
              </li><li>
                <p class="Para" id="Par33">What type of backup makes the most sense given your workloads?</p>
              </li></ul></div></div>
            <p class="Para" id="Par34">For example, if you’re working on a food delivery app, a large backup that kicks off in the middle of the Friday lunch <span id="ITerm12">surge</span> could result in lost business. The pain could be alleviated by running regular backups during predictable downtimes (e.g., very early in the morning), when there are resources to spare.</p>
            <p class="Para" id="Par35">But other businesses don’t have a predictable downtime. For another example, consider an application that provides location tracking services for ambulances—a use case where a catastrophic event could bring a dramatic surge at any time without warning. In that case, many small and frequent backups might be the best strategy. This way, backups are unlikely to significantly impact database performance, no matter when the unpredictable demand happens to rise.</p>
            <p class="Para" id="Par36">Work with your team to understand the backup coverage that you need and what type of backup pain you’re willing to accept, then adjust your options accordingly.</p>
            <div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1">
              <div class="Heading">Note</div>
              <p class="Para FirstParaInFormalPara" id="Par37">Repairs are a totally different process, but they have a similar impact. Eventually consistent databases need to ensure that replicas (eventually) all have the appropriate updates. In Cassandra and Cassandra-like databases, this process is referred to as <em class="EmphasisTypeItalic ">repairs</em>. When repair runs, it could cause latency to spike. The key to minimizing its performance impact varies according to your workload. If there’s a time when your database is predictably idle, run repair then—with high parallelism and intensity. If your use case can withstand minor latency spikes, you can try to limit the repair’s intensity and parallelism. But, if you can’t afford <em class="EmphasisTypeItalic ">any</em> latency spikes (e.g., a real-time bidding use case that must provide sub-millisecond P9999 latencies around the clock), your best bet is to limit the operation to run as slowly as possible.</p>
            </div>
          </section>

        </section>

        <section class="Section1 RenderAsSection1" id="Sec6">
          <h2 class="Heading">Compaction</h2>
          <p class="Para" id="Par38">As mentioned in Chapter <span class="ExternalRef"><a href="541783_1_En_2_Chapter.xhtml"><span class="RefSource">2</span></a></span> and covered more in Appendix A, <span id="ITerm13">LSM-based databases</span> use <em class="EmphasisTypeItalic ">compaction</em>—a process of rewriting tables to remove deleted entries and reorganize data to enable faster, more efficient reads and writes. Compaction operations are expensive in terms of CPU, memory, and disk I/O.<sup><a epub:type="noteref" href="#Fn1" id="Fn1_source" role="doc-noteref">1</a></sup></p>
          <p class="Para" id="Par40">The degree to which you can control compaction varies dramatically from database to database. For example, with Bigtable, it’s all done automatically. However, databases such as Couchbase, HBase, Cassandra, and <span id="ITerm14">ScyllaDB</span> let you choose from a variety of compaction strategies, many of which have additional options you can use to fine-tune how compaction is performed, as well as other settings that influence compaction performance (for example, rate-limiting it).</p>
          <section class="Section2 RenderAsSection2" id="Sec7">
            <h3 class="Heading">Impacts</h3>
            <div class="Para" id="Par41">The performance impact of <span id="ITerm15">compaction</span> also varies dramatically from database to database. One fundamental factor that influences compaction speed is whether the database is performing the major compactions on each shard/CPU concurrently, or the compaction is bound to a single thread. As shown in Figure <span class="InternalRef"><a href="#Fig2">11-2</a></span>, benchmarks found that there can reflect a nearly 60X difference in the time required to run a major compaction of 1TB of data at RF=1 on i3.4xlarge machines.<figure class="Figure" id="Fig2"><div class="MediaObject" id="MO2">
                <img alt="" aria-describedby="d65e824" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Fig2_HTML.jpg" style="width:42.75em"/><div class="TextObject" id="d65e824">
                  <p class="Para" id="Par65">A bar graph of time taken versus compaction on databases. The lowest time taken is 36 minutes for Scylla 4 dot 4 dot 3 and the highest is 37 hours 56 minutes for Cassandra 4 dot 0 dot 0.</p>
                </div>
                
              </div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 11-2</span>
                  <p class="SimplePara">The wide range of time required to perform compaction on similar databases—from 36 minutes to 37 hours and 56 <span id="ITerm16">minutes</span></p>
                </div></figcaption></figure></div>
            <div class="Para" id="Par42">Additional factors that influence the impact of compaction include:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li>
                <p class="Para" id="Par43"><strong class="EmphasisTypeBold ">Compaction backlog</strong>: Since compacting data is a process that is always running in the background, the amount of data to compact is expressed by its growing backlog. If compaction falls behind, it will eventually try to catch up in an attempt to keep the database from running out of resources and to minimize read amplification. A growing compaction backlog indicates that the cluster is not sized appropriately, the use case in question is using an inappropriate compaction strategy, or the process is being throttled too aggressively in the database settings.</p>
              </li><li>
                <p class="Para" id="Par44"><strong class="EmphasisTypeBold ">Inefficient compaction strategy selection</strong>: Write-mostly workloads are different from read-mostly workloads, which are different from update-heavy and delete-heavy workloads. Understanding the concepts behind every compaction strategy and how it impacts your workload is important to avoid read amplification, write amplification, or space <span id="ITerm17">amplification</span>.</p>
              </li><li>
                <p class="Para" id="Par45"><strong class="EmphasisTypeBold ">Compaction throughput</strong>: In situations where your use case relies heavily on reading from cold data, having overly aggressive compaction throughput would end up stealing some important IOPS and bandwidth needed for your workload. Play with different rate-limiting values and keep an eye on your compaction backlog until you find your sweet spot.</p>
              </li></ul></div></div>
            <p class="Para" id="Par46">An inefficient compaction strategy may affect workloads differently, depending on what level of inefficiency it is. For example, a write-heavy workload will typically want to prevent compactions from running too aggressively; otherwise, it may exhaust the existing disk bandwidth capacity and eventually throttle down the <span id="ITerm18">database</span> write path. On the other hand, a read-heavy workload will likely want compaction to run <em class="EmphasisTypeItalic ">more</em> aggressively, given that compactions may actually improve read latencies by requiring the database to issue fewer underlying storage disk I/O operations. Time-series use cases will typically prefer data to be separated into buckets so that eventual eviction can be done efficiently. And so on, and so on.</p>
          </section>

          <section class="Section2 RenderAsSection2" id="Sec8">
            <h3 class="Heading">Optimization</h3>
            <div class="Para" id="Par47">When selecting a compaction strategy, keep in mind that the ultimate goal should be low amplification. You want to <span id="ITerm19">avoid</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li>
                <p class="Para" id="Par48">Read amplification (read requests needing many files to look up relevant data)</p>
              </li><li>
                <p class="Para" id="Par49">Excessive temporary disk space that requires the disk to be larger than a perfectly-compacted representation of the data (space amplification)</p>
              </li><li>
                <p class="Para" id="Par50">Compacting the same data over and over again (write amplification)</p>
              </li><li>
                <p class="Para" id="Par51">Overwritten/deleted/expired data remaining on disk, slowing down your read path</p>
              </li></ul></div></div>
            <div class="Para" id="Par52">Since not everyone is using a database that performs compaction, this chapter doesn’t go deep into the weeds of the pros and cons of specific <span id="ITerm20">strategies</span>. Table <span class="InternalRef"><a href="#Tab1">11-1</a></span> provides an overview of which compaction strategy <em class="EmphasisTypeItalic ">generally</em> works best for different workloads (your results may vary).<div class="Table" id="Tab1"><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 11-1</span>
                  <p class="SimplePara">Comparing Compaction <span id="ITerm21">Strategies</span></p>
                </div></div><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"/><col class="tcol2 align-left"/><col class="tcol3 align-left"/><col class="tcol4 align-left"/><col class="tcol5 align-left"/><col class="tcol6 align-left"/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"> </th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara">Size-Tiered</p>
                    </th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara">Leveled</p>
                    </th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara">Incremental</p>
                    </th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara">Time Window</p>
                    </th><th style="border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara">Comments</p>
                    </th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara"><strong class="EmphasisTypeBold ">Write-only</strong></p>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e996" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figa_HTML.jpg" style="width:1.69em"/><span class="TextObject" id="d65e996">
                          <span class="Para" id="Par66">An icon of a check mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1010" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figb_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1010">
                          <span class="Para" id="Par67">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1024" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figc_HTML.jpg" style="width:1.69em"/><span class="TextObject" id="d65e1024">
                          <span class="Para" id="Par68">An icon of a check mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1038" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figd_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1038">
                          <span class="Para" id="Par69">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara">When using size-tiered with write-only workloads, it will use approximately 2x peak space. With incremental, the size amplification is much less.</p>
                      <p class="SimplePara">When using leveled compaction with write-only workloads, you will experience high write amplification.</p>
                    </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara"><strong class="EmphasisTypeBold ">Overwrite</strong></p>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1065" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Fige_HTML.jpg" style="width:1.69em"/><span class="TextObject" id="d65e1065">
                          <span class="Para" id="Par70">An icon of a check mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1079" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figf_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1079">
                          <span class="Para" id="Par71">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1093" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figg_HTML.jpg" style="width:1.69em"/><span class="TextObject" id="d65e1093">
                          <span class="Para" id="Par72">An icon of a check mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1107" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figh_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1107">
                          <span class="Para" id="Par73">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara">When using size-tired or incremental with overwrite workloads, size amplification occurs.</p>
                      <p class="SimplePara">When using leveled compaction with overwrite workloads, write amplification occurs.</p>
                    </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara"><strong class="EmphasisTypeBold ">Read-mostly, with few updates</strong></p>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1134" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figi_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1134">
                          <span class="Para" id="Par74">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1148" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figj_HTML.jpg" style="width:1.69em"/><span class="TextObject" id="d65e1148">
                          <span class="Para" id="Par75">An icon of a check mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1162" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figk_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1162">
                          <span class="Para" id="Par76">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1176" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figl_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1176">
                          <span class="Para" id="Par77">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara">When using size-tiered with read-mostly workloads with few updates, size amplification and read amplification occur.</p>
                    </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara"><strong class="EmphasisTypeBold ">Read-mostly, with many updates</strong></p>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1201" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figm_HTML.jpg" style="width:1.69em"/><span class="TextObject" id="d65e1201">
                          <span class="Para" id="Par78">An icon of a check mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1215" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Fign_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1215">
                          <span class="Para" id="Par79">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1229" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figo_HTML.jpg" style="width:1.69em"/><span class="TextObject" id="d65e1229">
                          <span class="Para" id="Par80">An icon of a check mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1243" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figp_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1243">
                          <span class="Para" id="Par81">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-bottom: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara">When using leveled with read-mostly workloads with many updates, write amplification occurs in excess.</p>
                    </td></tr><tr><td style="border-right: 0.5pt solid ; text-align: left;">
                      <p class="SimplePara"><strong class="EmphasisTypeBold ">Time series</strong></p>
                    </td><td style="border-right: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1268" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figq_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1268">
                          <span class="Para" id="Par82">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1282" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figr_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1282">
                          <span class="Para" id="Par83">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1296" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figs_HTML.jpg" style="width:1.5em"/><span class="TextObject" id="d65e1296">
                          <span class="Para" id="Par84">An icon of a cross mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="border-right: 0.5pt solid ; text-align: left;">
                      <div class="SimplePara">
                        <img alt="" aria-describedby="d65e1310" src="../images/541783_1_En_11_Chapter/541783_1_En_11_Figt_HTML.jpg" style="width:1.69em"/><span class="TextObject" id="d65e1310">
                          <span class="Para" id="Par85">An icon of a check mark.</span>
                        </span>
                        
                      </div>
                    </td><td style="text-align: left;">
                      <p class="SimplePara">When using size-tiered or incremental with time series workloads, size amplification, read amplification, and write amplification all occur.</p>
                      <p class="SimplePara">When using leveled with time series workloads, size amplification and write amplification occur.</p>
                    </td></tr></tbody></table></div></div>
            <p class="Para" id="Par53">Two key takeaways should be that 1) one size never fits all, so it’s nice to have a choice in admin matters, and 2) tradeoffs are inevitable—know what pain you can tolerate best so pick your poison.</p>
            <p class="Para" id="Par54">To drive the point home, here’s a real-world story. Once upon a time, a new ScyllaDB user reported high read latencies. The use case was a TTL’d time series to support live media streaming. Time series use cases heavily rely on fetching data in specific timeframes and expect that such lookups are fast enough to be served by the database. As a result, time series use cases often rely on a Time-Bucketed compaction strategy, which ensures that the data in <span id="ITerm22">question</span> is compacted together under the same time window to avoid the database having to potentially scan through multiple files across distinct windows just to retrieve the data. However, if configured incorrectly, the strategy may backfire and introduce severe performance headaches.</p>
            <p class="Para" id="Par55">In this particular situation, we discovered that their time buckets were too small for the amount of data they were frequently retrieving as part of a single query. For example, if you decide to time-bucket your data every ten minutes, but always want to retrieve ten hours’ worth of data, that will require the database to scan through 60 (6 buckets/hour * 10 hours) of buckets! With the right amount of concurrency, every query scanning through these large chunks of data could starve the underlying disk I/O capacity. Therefore, the resolution was to update the compaction configuration to reflect a more realistic data grouping as required by the use case.</p>
            <p class="Para" id="Par56">One final note on adjusting your compaction strategy for performance: Remember that when you adjust your compaction strategy, your database will need to rewrite all your table data. This will incur a significant performance penalty and should be carefully planned to occur at a time that works best for your business.</p>
          </section>

        </section>

        <section class="Section1 RenderAsSection1" id="Sec9">
          <h2 class="Heading">Summary</h2>
          <p class="Para" id="Par57">Admin operations like repair, compactions, and backups are an unavoidable part of running a healthy, well-performing database. There’s no such thing as a “zero impact” admin operation; performing any operation consumes resources, and these operations can have exacerbated impacts if you’re operating at extreme scale. This chapter used the examples of backups and compaction to showcase the potentially significant—and also highly variable—impact of admin operations on performance.</p>
          <div class="Para" id="Par58">This is the final official chapter of this book—the end of these highly opinionated recommendations for improving database performance based on what we’ve seen working with a broad range of database users and databases. It’s hardly the end of options for optimizing database performance though. Some potential next steps:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li>
              <p class="Para" id="Par59">Flag the considerations/recommendations that seem to offer potential for your specific workloads and use case, then discuss with your team.</p>
            </li><li>
              <p class="Para" id="Par60">Take another look at your database’s specific options (e.g., for monitoring, drivers, admin, etc.) and see if it’s time to rethink any of your previous decisions.</p>
            </li><li>
              <p class="Para" id="Par61">Tap your database vendor and/or community to learn about performance-related engineering <span id="ITerm23">decisions</span> and optimizations that might offer untapped opportunities (or be responsible for some of your current constraints).</p>
            </li><li>
              <p class="Para" id="Par62">Consider whether your data modeling might need a tune-up or overhaul (monitoring can help you assess this). If so, we recommend <em class="EmphasisTypeItalic ">NoSQL Distilled</em> by Pramod J. Sadalge and Martin Fowler—assuming you’re using NoSQL. If not, browse the wealth of resources on RDBMS data modeling.</p>
            </li><li>
              <p class="Para" id="Par63">Continue learning more about the fundamental database design decisions made when building any distributed database: replication and sharding strategies, consensus algorithms, data structures (B-tree vs LSM tree), and so on. You can get a performance-focused introduction to these topics, as well as recommendations for learning more from the masters, in Appendix A.</p>
            </li></ul></div></div>
        </section>

      <div class="License LicenseSubType-cc-by"><a href="https://creativecommons.org/licenses/by/4.0"><img alt="Creative Commons" src="../css/cc-by.png"/></a>
            <p class="SimplePara"><strong class="EmphasisTypeBold ">Open Access</strong> This chapter is licensed under the terms of the Creative Commons Attribution 4.0 International License (<span class="ExternalRef"><a href="http://creativecommons.org/licenses/by/4.0/"><span class="RefSource">http://​creativecommons.​org/​licenses/​by/​4.​0/​</span></a></span>), which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license and indicate if changes were made.</p>
            <p class="SimplePara">The images or other third party material in this chapter are included in the chapter's Creative Commons license, unless indicated otherwise in a credit line to the material. If material is not included in the chapter's Creative Commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder.</p>
          </div><aside aria-label="Footnotes" class="FootnoteSection" epub:type="footnotes"><div class="Heading">Footnotes</div><div class="Footnote"><span class="FootnoteNumber"><a href="#Fn1_source">1</a></span><div class="FootnoteContent" epub:type="footnote" id="Fn1" role="doc-footnote"><p class="Para" id="Par39">For an interesting perspective on compaction, see Avi Kivity’s real-time visualization in “How a Database Looks from a Disk’s Perspective” (<span class="ExternalRef"><a href="http://www.p99conf.io/session/how-a-database-looks-from-a-disks-perspective/"><span class="RefSource"><span class="EmphasisFontCategoryNonProportional ">www.p99conf.io/session/how-a-database-looks-from-a-disks-perspective/</span></span></a></span>).</p></div><div class="ClearBoth"> </div></div></aside></div></div></body></html>